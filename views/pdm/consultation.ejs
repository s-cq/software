<div class="pj__left layui-form">
    <%- include('pdmnav.ejs') %>
    <div class="dis-none titleMent">
        <h1>当前阶段未开启</h1>
    </div>
    <div class="dis-none titleCreted">
        <div id="orderBox">
        </div>
    </div>
</div>
<script id="ordertpl" type="text/html">
    <!-- 一、信息 -->
    <div class="cu-card">
        <div class="cu-card__title">
          <div class="cu-card__inner">
            <i class="cu-card__line"></i>
            <span class="">个人资料<span class="cRed">（必填）</span></span>
          </div>
        </div>
        <div class="cu-card__main is-not-hidden">
          <div class="layui-form-item">
            <div class="col-6">
                <label class="layui-form-label">年龄</label>
                <div class="layui-input-block">
                  <input type="text" name="age" autocomplete="off" {{d.findStage.age !== undefined && d.findStage.age !== '' && d.findStage.age !== null ? 'disabled' : ''}}  value="{{d.findStage.age == undefined ? '' : d.findStage.age}}" placeholder="请输入年龄" class="layui-input"/>
                </div>
              </div>
              <div class="col-8">
                <label class="layui-form-label">身份证号</label>
                <div class="layui-input-block">
                  <input type="text" name="idCader"  {{d.findStage.idcard !== undefined && d.findStage.idcard !== '' && d.findStage.idcard !== null ? 'disabled' : ''}} autocomplete="off" value="{{d.findStage.idcard == undefined ? '' : d.findStage.idcard}}"  placeholder="请输入身份证号"  class="layui-input idCader-width"/>
                </div>
              </div>
              <div class="fr">
                <label class="layui-form-label">婚否</label>
                <div class="layui-input-block">
                    {{# if (d.findStage.is_marry == 1) { }}
                        <input type="radio" name="marriage" value="0" title="已婚" disabled>
                        <input type="radio" name="marriage" value="1" title="未婚" checked="" disabled>
                    {{# } else if(d.findStage.is_marry == 0) { }}
                        <input type="radio" name="marriage" value="0" title="已婚" checked=""  disabled>
                        <input type="radio" name="marriage" value="1" title="未婚" disabled>
                    {{# } else { }}
                        <input type="radio" name="marriage" value="0" title="已婚" checked="" >
                        <input type="radio" name="marriage" value="1" title="未婚">
                    {{# } }}
                </div>
              </div>
          </div>
          
          
          <div class=" col-12 mb10" >
            <label class="layui-form-label">身份证正面</label>
            <div class="layui-input-block">
              <div class="cu-details__inner-upload">
                    <div class="fl mr-4 layui-upload-drag bind-upload order-upload ml10 mt7 preMnetWidh file positive" id="4" type='file' >
                        <i class="layui-icon" style="color:#ccc;"></i>
                        <p >点击上传</p>
                    </div>
                    <ul class="fl upload-list repair mt7" id="uploadImg4">
                        {{#  layui.each(d.photoAll, function(index, item){ }}
                            {{#  if(item.attr_modelid == 4) { }}
                                <div class="viewer-images relative fl ml10">
                                    <img data-group="" data-src="{{item.attrPhoto}}" layer-src="{{item.attrPhoto}}" src="{{item.attrPhoto}}" width="80px" height="80px" alt="">
                                </div>
                            {{#  } }}
                        {{#  }); }}
                    </ul>
                </div>
              </div>
          </div>
          <div class="col-12 mb10">
            <label class="layui-form-label">身份证反面</label>
            <div class="layui-input-block">
              <div class="cu-details__inner-upload">
                    <div class="fl mr-4 layui-upload-drag bind-upload order-upload ml10 mt7 preMnetWidh file side" id="8" type='file'>
                        <i class="layui-icon" style="color:#ccc;"></i>
                        <p >点击上传</p>
                    </div>
                    <ul class="fl upload-list repair mt7" id="uploadImg8">
                        {{#  layui.each(d.photoAll, function(index, item){ }}
                        {{#  if(item.attr_modelid == 8) { }}
                            <div class="viewer-images relative fl ml10">
                                <img data-group="" data-src="{{item.attrPhoto}}" layer-src="{{item.attrPhoto}}" src="{{item.attrPhoto}}" width="90px" height="90px" alt="">
                            </div>
                            {{#  } }}
                        {{#  }); }}
                    </ul>
                </div>
              </div>
           </div>
          </div>
          <div class="layui-form-item">
            <label class="layui-form-label">现住址</label>
            <div class="layui-input-block">
                <div class="col-2">
                  <span class="fl ml-2 lh-30">省</span>
                </div>
                <div class="col-4">
                    <select name="provincecityVlaue" lay-filter="province"  id="province">
                    </select>
                </div>
                <div class="col-2">
                   <span class="fl ml-2 lh-30">市</span>
                </div>
                <div class="col-4">
                    <select id="cityMentList" name="cityVlaue"  lay-filter="city" >
                    </select>
                </div>
                <div class="col-2">
                   <span class="fl ml-2 lh-30">区</span>
                </div>
                <div class="col-4">
                    <select id="areaMent" name="areaVlaue"  lay-filter="area" >
                    </select>
                </div>
            </div>
            <div class="layui-input-block mt10 clear">
              <input type="text" name="addPress" autocomplete="off" {{d.findStage.nowAddress !== undefined && d.findStage.nowAddress !== '' && d.findStage.nowAddress !== null ? 'disabled' : '' }} value="{{d.findStage.nowAddress == undefined ? '' : d.findStage.nowAddress}}"  placeholder="请输入地址"  class="layui-input mt10"/>
            </div>
          </div>
          <!-- <div class="tx-right">
            <button type="button"  class="layui-btn layui-btn-sm layui-btn-normal bind-save" lay-submit lay-filter="conditionBasics">保存</button>
          </div> -->
    </div> 
    <!-- 紧急联系人 -->
    <div class="cu-card mt-4">
        <div class="cu-card__title">
          <div class="cu-card__inner">
            <i class="cu-card__line"></i>
            <span class="">紧急联系人<span class="cRed">（必填）</span></span>
          </div>
        </div>

        <div class="cu-card__main is-not-hidden">
            <div class="layui-form-item">
                <div class="col-12">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-block">
                    <input type="text" {{d.findStage.linkName !== undefined && d.findStage.linkName !== '' && d.findStage.linkName !== null ? 'disabled' : ''}} value="{{d.findStage.linkName == undefined ? '' : d.findStage.linkName}}" name="orderName" autocomplete="off" placeholder="请输紧急联系人姓名" class="layui-input">
                    </div>
                </div>
                <div class="col-12">
                    <label class="layui-form-label">电话</label>
                    <div class="layui-input-block">
                    <input type="text" {{d.findStage.linkPhone !== undefined && d.findStage.linkPhone !== '' && d.findStage.linkPhone !== null ? 'disabled' : ''}} value="{{d.findStage.linkPhone == undefined ? '' : d.findStage.linkPhone}}" name="orderPhone" autocomplete="off" placeholder="请输紧急联系人电话" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="col-12">
                    <label class="layui-form-label">微信</label>
                    <div class="layui-input-block">
                    <input type="text" value="{{d.findStage.family_wechat == undefined ? '' : d.findStage.family_wechat}}" {{d.findStage.family_wechat !== undefined && d.findStage.family_wechat !== '' && d.findStage.family_wechat !== null ? 'disabled' : ''}} name="orderWx" autocomplete="off" placeholder="请输紧急联系人微信" class="layui-input">
                    </div>
                </div>
                <div class="col-12">
                    <label class="layui-form-label">关系</label>
                    <div class="layui-input-block">
                        <select  name="relationship"  lay-filter="relationship" id="relationPressOrder" >
                            <option value="配偶">配偶</option>
                            <option value="父亲">父亲</option>
                            <option value="母亲">母亲</option>
                            <option value="子女">子女</option>
                        </select>
                    </div> 
                </div>
            </div >
             
            <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    {{# if (d.findStage.family_sex == 0) { }}
                        <input type="radio" name="sex" value="1" title="男" disabled>
                        <input type="radio" name="sex" value="0" title="女" checked disabled>
                    {{# } else if(d.findStage.family_sex == 1) { }}
                        <input type="radio" name="sex" value="1" title="男" checked disabled>
                        <input type="radio" name="sex" value="0" title="女" disabled>
                    {{# } else { }}
                        <input type="radio" name="sex" value="1" title="男" checked>
                        <input type="radio" name="sex" value="0" title="女" >
                    {{# } }}
                </div>
            </div>
          <!-- <div class="tx-right">
                <button type="button"  class="layui-btn layui-btn-sm layui-btn-normal bind-save" lay-submit lay-filter="conditionBasics">保存</button>
          </div> -->
        </div>
    </div>
     <!-- 三、证书 -->
    <div class="cu-card mt-4">
        <div class="cu-card__title">
          <div class="cu-card__inner">
            <i class="cu-card__line"></i>
            <span class="">学历<span class="cRed">（必填）</span></span>
          </div>
        </div>
        <div class="cu-card__main is-not-hidden">
            <div class="layui-form-item">
                <div class="col-12">
                    <label class="layui-form-label">学历</label>
                    <div class="layui-input-block">
                        <select name="education" lay-filter="education"  id="education">
                            <option value="初中">初中</option>
                            <option value="高中">高中</option>
                            <option value="中专">中专</option>
                            <option value="大专">大专</option>
                            <option value="本科">本科</option>
                        </select>
                    </div>
                </div>
                
            </div>
          <div class="layui-form-item">
            <label class="layui-form-label">学历照片</label>
            <div class="layui-input-block" >
                <div class="cu-details__inner-upload">
                    <div class="fl mr-4 layui-upload-drag bind-upload order-upload ml10 mt7 preMnetWidh file educationMnet" id="56" type='file'>
                        <i class="layui-icon" style="color:#ccc;"></i>
                        <p >点击上传</p>
                    </div>
                    <ul class="fl upload-list repair mt7" id="uploadImg56">
                        {{#  layui.each(d.photoAll, function(index, item){ }}
                        {{#  if(item.attr_modelid == 56) { }}
                            <div class="viewer-images relative fl ml10">
                                <img data-group="" data-src="{{item.attrPhoto}}" layer-src="{{item.attrPhoto}}" src="{{item.attrPhoto}}" width="90px" height="90px" alt="">
                            </div>
                            {{#  } }}
                        {{#  }); }}
                    </ul>
                </div>
            </div>
          </div>


          </div>
          <div class="layui-form-item">
            <!-- <button type="button"  class="layui-btn layui-btn-sm layui-btn-normal bind-save" lay-submit lay-filter="conditionBasics">保存</button> -->
          </div>
        </div>
        
    </div>
    <!-- 三、证书 -->
    <div class="cu-card mt-4">
        <div class="cu-card__title">
          <div class="cu-card__inner">
            <i class="cu-card__line"></i>
            <span class="">证书<span class="cRed">（必填）</span></span>
          </div>
        </div>
        <div class="cu-card__mains">
            <div class="col-12">
                <label class="layui-form-label">证书</label>
                <div class="layui-input-block">
                    <select name="certificate" lay-filter="certificate" id="certificate">
                        <option value="建造师证">建造师证</option>
                        <option value="造价师证">造价师证</option>
                        <option value="安全员证">安全员证</option>
                        <option value="电工证">电工证</option>
                        <option value="施工员证">施工员证</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item mt10">
         <div class=" col-12 mt10">
            <label class="layui-form-label">证件正面</label>
            <div class="layui-input-block" >
                <div class="cu-details__inner-upload">
                    <div class="fl mr-4 layui-upload-drag bind-upload order-upload ml10 mt7 preMnetWidh file certificateJust" id="57" type='file'>
                        <i class="layui-icon" style="color:#ccc;"></i>
                        <p >点击上传</p>
                    </div>
                    <ul class="fl upload-list repair mt7" id="uploadImg57">
                        {{#  layui.each(d.photoAll, function(index, item){ }}
                        {{#  if(item.attr_modelid == 57) { }}
                            <div class="viewer-images relative fl ml10">
                                <img data-group="" data-src="{{item.attrPhoto}}" layer-src="{{item.attrPhoto}}" src="{{item.attrPhoto}}" width="90px" height="90px" alt="">
                            </div>
                            {{#  } }}
                        {{#  }); }}
                    </ul>
                </div>
            </div>
          </div>
          <div class=" col-12 mt10">
            <label class="layui-form-label">证件反面</label>
            <div class="layui-input-block" >
                <div class="cu-details__inner-upload">
                    <div class="fl mr-4 layui-upload-drag bind-upload order-upload ml10 mt7 preMnetWidh file certificateBack" id="58" type='file'>
                        <i class="layui-icon" style="color:#ccc;"></i>
                        <p >点击上传</p>
                    </div>
                    <ul class="fl upload-list repair mt7" id="uploadImg58">
                        {{#  layui.each(d.photoAll, function(index, item){ }}
                        {{#  if(item.attr_modelid == 58) { }}
                            <div class="viewer-images relative fl ml10">
                                <img data-group="" data-src="{{item.attrPhoto}}" layer-src="{{item.attrPhoto}}" src="{{item.attrPhoto}}" width="90px" height="90px" alt="">
                            </div>
                            {{#  } }}
                        {{#  }); }}
                    </ul>
                </div>
            </div>
          </div>
        </div>
          <div class="layui-form-item">
            <!-- <button type="button"  class="layui-btn layui-btn-sm layui-btn-normal bind-save" lay-submit lay-filter="conditionBasics">保存</button> -->
          </div>
        </div>
        
    </div>
    <div class="tx-center mt-4">
        <button type="button"  class="layui-btn layui-btn-sm layui-btn-normal bind-save" lay-submit lay-filter="conditionBasics">保存</button>
    </div>

</script>
<style>
    .order-upload{
        width: 60px;
        height: 60px;
        padding: 15px;
    }bind-save
    .dis-none{
        display: none;
    }
    .idCader-width{
        width: 170px;
    }
    .cu-card__mains{
        padding-top: 15px;
    }
</style>
<script>
    layui.use(['form', 'upload'], function(){
        var form = layui.form;
    var upload = layui.upload;
    var uid = getCookie('uid');
    var http17 = 'https://papi.rxjy.com'
    var http16 = 'https://piapi.rxjy.com'
    var http18 = 'https://gxmrs.rxjy.com'
    var provinceList= [] // 省
    var cityList = [] //市
    var areaList = [] //区
    var adressMent = {}
    var findStage = {}
    var photoAll = []
    var findStIdObj = {}
    getAdressByUid()
    getUserPhotoList()
    upload.render({
    elem: '.order-upload' //绑定元素
    ,url: '/upload' //上传接口
    ,done: function(res){
      //上传完毕回调
    }
    ,error: function(){
      //请求异常回调
    }
  });
  // 查询地址 
    function getAdressByUid(){
        $.ajax({
            type: 'get',
            url: http18 + '/a/matters/userinfo/getAdressByUid',
            data: { uid: uid },
        }).done(result => {
            if (result.StatusCode === 0) {
            if (result.Body.length > 0) {
                adressMent = result.Body[0];
                findStIdByUid()
            }
            }
        });
    };
    // 查询联系人e
    function findStagInfoById(){
        $.ajax({
            type: 'get',
            url: http18 + '/api/ProjectManager/findStageInfoById',
            data: { uid: uid },
        }).done(result => {
            if (result.StatusCode === 0) {
                findStage = result.Body
                var getTpl = ordertpl.innerHTML
                ,view = document.getElementById('orderBox');
                var bankIndex = 0
                layui.use('laytpl', function(){
                    var laytpl = layui.laytpl;
                    var obj ={
                        'findStIdObj': findStIdObj,
                        'findStage': findStage,
                        'adressMent': adressMent,
                        'photoAll': photoAll
                    }
                    console.log(obj)
                    laytpl(getTpl).render(obj, function(html){
                    view.innerHTML = html;
                    });
                    photoAll.forEach(item => {
                        if (item.attr_modelid == 4) {
                            $('.positive').addClass('dis-none')
                            bankIndex = bankIndex + 1
                        } else if (item.attr_modelid == 8) {
                            $('.side').addClass('dis-none')
                            bankIndex = bankIndex + 1
                        } else if (item.attr_modelid == 56) {
                            $('.educationMnet').addClass('dis-none')
                            bankIndex = bankIndex + 1
                        } else if (item.attr_modelid == 57) {
                            $('.certificateJust').addClass('dis-none')
                            bankIndex = bankIndex + 1
                        } else if (item.attr_modelid == 58) {
                            $('.certificateBack').addClass('dis-none')
                            bankIndex = bankIndex + 1
                        }
                    })
                })
               GetProvinceMsg()
                if (adressMent !== null) {
                    var educationtHtml = ''
                    var educationList = [{valu: '初中'},{valu: '高中'},{valu: '中专'},{valu: '大专'},{valu: '本科'}]
                    educationList.forEach(item =>{
                        if (item.valu == findStage.education) {
                            educationtHtml +=`<option value="${item.valu}" selected readonly>${item.valu}</option>`
                        } else {
                            educationtHtml +=`<option value="${item.valu}" readonly>${item.valu}</option>`
                        }
                    })
                    if (findStage.education !== undefined && findStage.education !== null && findStage.education !== '') {
                        
                        $('#education').attr('disabled', 'disabled')
                    }
                    $('#education').html(educationtHtml)
                    var certificatetList = [{valu: '建造师证'},{valu: '造价师证'},{valu: '安全员证'},{valu: '电工证'},{valu: '施工员证'},{valu: '其他'}]
                    var certificatetHtml = ''
                    certificatetList.forEach(item =>{
                        if (item.valu == findStage.certificates) {
                            certificatetHtml +=`<option value="${item.valu}"  selected>${item.valu}</option>`
                        } else {
                            certificatetHtml +=`<option value="${item.valu}" >${item.valu}</option>`
                        }
                    })
                    if (findStage.certificates !== null && findStage.certificates !== undefined && findStage.certificates !== '') {
                        $('#certificate').attr('disabled', 'disabled')
                    }
                    $('#certificate').html(certificatetHtml)
                    form.render();
                    var relationPressList = [{valu: '配偶', id: 3},{valu: '父亲',id: 1},{valu: '母亲',id: 2}, {valu: '子女',id: 4}]
                    var relationPresstHtml = ''
                    relationPressList.forEach(item =>{
                        if (item.id == findStage.linkClassify) {
                            relationPresstHtml +=`<option value="${item.valu}" selected readonly>${item.valu}</option>`
                        } else {
                            relationPresstHtml +=`<option value="${item.valu}" readonly>${item.valu}</option>`
                        }
                    })
                    if (findStage.family_relation !== '' && findStage.family_relation !== undefined && findStage.family_relation !== null) {
                        $('#relationPressOrder').attr('disabled', 'disabled')
                        
                    }
                    $('#relationPressOrder').html(relationPresstHtml)
                }
                form.render();
                if (findStIdObj.st_id >= 2) {
                $('.titleCreted').removeClass('dis-none')
            } else {
                $('.titleMent').removeClass('dis-none')
            }
            var basicInfo = {}
            basicInfo.age = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('bank_name') ? findStage.age === '' ? '--' : findStage.age : '--'
            basicInfo.idcard = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('idcard') ? findStage.idcard === '' ? '--' : findStage.idcard : '--'
            basicInfo.is_marry = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('is_marry') ? findStage.is_marry === '' ? '--' : findStage.is_marry : '--'
            basicInfo.province_id = adressMent !== null && adressMent !== undefined && adressMent.hasOwnProperty('province_id') ? adressMent.province_id === '' ? '--' : adressMent.province_id : '--'
            basicInfo.city_id = adressMent !== null && adressMent !== undefined && adressMent.hasOwnProperty('city_id') ? adressMent.city_id === '' ? '--' : adressMent.city_id : '--'
            basicInfo.county_value = adressMent !== null && adressMent !== undefined && adressMent.hasOwnProperty('county_value') ? adressMent.county_value === '' ? '--' : adressMent.county_value : '--'
            basicInfo.linkName = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('linkName') ? findStage.linkName === '' ? '--' : findStage.linkName : '--'
            basicInfo.family_wechat = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('family_wechat') ? findStage.family_wechat === '' ? '--' : findStage.family_wechat : '--'
            basicInfo.family_relation = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('family_relation') ? findStage.family_relation === '' ? '--' : findStage.family_relation : '--'
            basicInfo.family_sex = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('family_sex') ? findStage.family_sex === '' ? '--' : findStage.family_sex : '--'
            basicInfo.education = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('education') ? findStage.education === '' ? '--' : findStage.education : '--'
            basicInfo.certificates = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('certificates') ? findStage.certificates === '' ? '--' : findStage.certificates : '--'
            basicInfo.nowAddress = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('nowAddress') ? findStage.nowAddress === '' ? '--' : findStage.nowAddress : '--'
            basicInfo.linkPhone = findStage !== null && findStage !== undefined && findStage.hasOwnProperty('linkPhone') ? findStage.linkPhone === '' ? '--' : findStage.linkPhone : '--'
            basicInfo.isPerfect = true
            for (const key in basicInfo) {
                if (basicInfo[key] === '--' || basicInfo[key] === '') {
                    basicInfo.isPerfect = false
                }
            }
            if (basicInfo.isPerfect && bankIndex == 5) {
                $('.bind-save').addClass('dis-none')
            }
            form.render();
            layer.photos({
                photos: '.viewer-images'
                ,anim: 0 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
            });
            uploadFunction()


            }
        });
    };
    function getUserPhotoList() {
        $.ajax({
          type: 'get',
          url: http18 +  '/api/ProjectManager/getUserPhotoList',
          data: { uid: uid },
        }).done(result => {
          if (result.StatusCode === 0) {
            photoAll = result.Body;
          }
        });
    }
  // 查询 阶段
    function findStIdByUid() {
        $.ajax({
          type: 'get',
          url: http18 + '/api/ProjectRecruit/findStIdByUid',
          data: { uid: uid },
        }).done(result => {
          if (result.StatusCode === 0) {
            findStIdObj = result.Body;
            findStagInfoById()
          }
        });
    };
    /**
     * 查询省
     */
    function GetProvinceMsg() {
        const self = this;
        $.ajax({
          type: 'get',
          url: http18 + '/a/matters/userinfo/GetProvinceMsg',
          data: '',
        }).done(result => {
          if (result.StatusCode === 0) {
            provinceList = result.Body;
            let provinceHtml = '';
            provinceList.forEach(item =>{
                if (item.provinceId == adressMent.province_id ) {
                    provinceHtml +=`<option value="${item.provinceId}" selected>${item.provinceName}</option>`
                } else {
                    provinceHtml +=`<option value="${item.provinceId}">${item.provinceName}</option>`
                }
            })
            if (adressMent.province_id !== undefined && adressMent.province_id !== '' && adressMent.province_id !== '') {
                $('#province').attr('disabled', 'disabled')
            }
            $('#province').html(provinceHtml)
            form.render();
            if (adressMent.province_id == '') {
                getCityMsgByProvinceId(result.Body[0].provinceId);
            } else {
                getCityMsgByProvinceId(adressMent.province_id,1);
            }
            form.render();

          }
        });
      };
    /**
     * 查询市
     */
    function getCityMsgByProvinceId(provinceId, index) {
        const self = this;
        $.ajax({
          type: 'get',
          url: http18 + '/a/matters/userinfo/getCityMsgByProvinceId',
          data: { provinceId },
        }).done(result => {
          if (result.StatusCode === 0) {
            cityList = result.Body;
            var cityMentListHtml = ''
            cityList.forEach(item =>{
                if (item.cityId == adressMent.city_id) {
                    cityMentListHtml +=`<option value="${item.cityId}" selected>${item.cityName}</option>`
                } else {
                    cityMentListHtml +=`<option value="${item.cityId}">${item.cityName}</option>`
                }
            })
            if (adressMent.city_id !== undefined && adressMent.city_id !== '' && adressMent.city_id !== '') {
                $('#cityMentList').attr('disabled', 'disabled')
            }
            $('#cityMentList').html(cityMentListHtml)
            if (index === 1) {
              form.render();
              if (adressMent.city_id !== null || adressMent.city_id !== '' || adressMent.city_id == undefined) {
                  getCountyMsgByCity(adressMent.city_id, 1);
              } else {
                getCountyMsgByCity(result.Body[0].cityId);
              }
            } else {
                form.render();
              getCountyMsgByCity(result.Body[0].cityId);
            }
          }
        });
      };
    /**
     * 查询区
     */
    function getCountyMsgByCity(cityId, index) {
        $.ajax({
          type: 'get',
          url: http18 + '/a/matters/userinfo/getCountyMsgByCityId',
          data: { cityId },
        }).done(result => {
          if (result.StatusCode === 0) {
            areaList = result.Body;
            let html = '';
            areaList.forEach(item => {
                if (item.countyId == adressMent.county_value) {
                html += `<option value="${item.countyId}" selected>${item.countyName}</option>`;
                } else {
                html += `<option value="${item.countyId}">${item.countyName}</option>`;
                }
            });
            if (adressMent.county_value !== undefined && adressMent.county_value !== '' && adressMent.county_value !== '') {
                $('#areaMent').attr('disabled', 'disabled')
            }
            $('#areaMent').html(html);
            form.render();
          }
        });
      };
    // 下拉 省
    form.on('select(province)', function(data) {
        getCityMsgByProvinceId(data.value, 1)
    });
    // 下拉 市
    form.on('select(city)', function(data) {
        getCountyMsgByCity(data.value, 1)
    });
    // 点击保存
    form.on('submit(conditionBasics)', function(data){
        console.log(data.field)
        var data = data.field
        const obj = {
            uid: uid,
            age: data.age,
            isMarry: data.marriage,
            address: data.addPress,
            education: data.education,
            certificates: data.certificate,
            familyName: data.orderName,
            familyRelation: data.relationship,
            familyPhone: data.orderPhone,
            familyWechat: data.orderWx,
            familySex: data.sex,
          };
          // 地址 和 地区
          const objTwo = {
            uid: uid,
            AddressDetail: data.addPress,
            typeValue: '',
            AddressProvinceId: data.provincecityVlaue,
            AddressCityId: data.cityVlaue,
            AddressCountyId: data.areaVlaue,
          };
          // 身份正号
        const objThree = {
            uid: uid,
            IDCard: data.idCader,
        };
        $.ajax({
            type: 'post',
            url: http18 + '/api/stageInfo/updateStageInfoByleId',
            data: obj,
          }).done(result => {
            if (result.StatusCode === 0) {
              $.ajax({
                type: 'post',
                url: http18 + '/api/stageInfo/updateUserTypeValueAndAddress',
                data: objTwo,
              }).done(result => {
                if (result.StatusCode === 0) {
                  $.ajax({
                    type: 'post',
                    url: http18 + '/api/stageInfo/updateIDCard',
                    data: objThree,
                  }).done(result => {
                    if (result.StatusCode === 0) {
                      layer.msg('提交成功');
                    }
                  });
                }
              });

            }
        });

    })
     /**
       * 身份证照片 学历 证件上传
       */
    function savePhotoByUid(attrModelid, FileUrl) {
        const obj = {
          uid: uid,
          attrModelid,
          userType: 1,
          attrServerUrl: '',
          attrFileUrl: FileUrl,
        };
        $.ajax({
          type: 'post',
          url: http18 + '/a/api/person/savePhotoByUid',
          data: obj,
        }).done(result => {
          if (result.StatusCode === 0) {
            getUserPhotoList()
              var html =''
              html = `<div class="viewer-images relative fl ml10">
                        <img data-group="" data-src="${FileUrl}" layer-src="${FileUrl}" src="${FileUrl}" width="90px" height="90px" alt="">
                    </div>`
             $('#uploadImg' + attrModelid).html(html)
             layer.photos({
                photos: '.viewer-images'
                ,anim: 0 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
            });
            //  getAdressByUid()
            layer.msg('上传成功');
            getAdressByUid()
          }
        });
      };
    function uploadFunction(){
        $(".file").each(function() {
            uploads({
                // 上传控件ID
                id: $(this).attr("id"),
                // 是否传多个文件
                mutil: true,
                // 上传文件类型
                mime_types: [{
                    title: "Image",
                    extensions: "jpg,gif,png"
                }],
                // 上传成功后回调函数 servername 图片域名  filename图片地址 url 图片全地址 id 上传空间ID
                callback: function(servername, filename, url, id) {
                    savePhotoByUid(id,url )
                }
            })
            })  
    }
    
    form.render()
   });
</script>